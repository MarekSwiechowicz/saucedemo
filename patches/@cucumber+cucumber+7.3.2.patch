diff --git a/node_modules/@cucumber/cucumber/lib/formatter/builder.js b/node_modules/@cucumber/cucumber/lib/formatter/builder.js
index 239c73b..1464e09 100644
--- a/node_modules/@cucumber/cucumber/lib/formatter/builder.js
+++ b/node_modules/@cucumber/cucumber/lib/formatter/builder.js
@@ -74,15 +74,29 @@ const FormatterBuilder = {
         });
     },
     loadCustomFormatter(customFormatterPath, cwd) {
-        const CustomFormatter = create_require_1.default(cwd)(customFormatterPath);
-        if (typeof CustomFormatter === 'function') {
-            return CustomFormatter;
+        try {
+            const CustomFormatter = create_require_1.default(cwd)(customFormatterPath);
+            if (typeof CustomFormatter === 'function') {
+                return CustomFormatter;
+            }
+            else if (value_checker_1.doesHaveValue(CustomFormatter) &&
+                typeof CustomFormatter.default === 'function') {
+                return CustomFormatter.default;
+            }
+            throw new Error(`Custom formatter (${customFormatterPath}) does not export a function`);
+        } catch (e) {
+            if (e.message && e.message.includes('ESM graph')) {
+                const url_1 = require('url');
+                const path_2 = require('path');
+                const formatterPath = customFormatterPath.startsWith('file://') 
+                    ? url_1.fileURLToPath(customFormatterPath)
+                    : path_2.isAbsolute(customFormatterPath) 
+                        ? customFormatterPath
+                        : path_2.resolve(cwd, customFormatterPath);
+                return require(formatterPath.replace(/\.js$/, '.cjs') || formatterPath);
+            }
+            throw e;
         }
-        else if (value_checker_1.doesHaveValue(CustomFormatter) &&
-            typeof CustomFormatter.default === 'function') {
-            return CustomFormatter.default;
-        }
-        throw new Error(`Custom formatter (${customFormatterPath}) does not export a function`);
     },
 };
 exports.default = FormatterBuilder;
diff --git a/node_modules/@cucumber/cucumber/lib/support_code_library_builder/build_helpers.js b/node_modules/@cucumber/cucumber/lib/support_code_library_builder/build_helpers.js
index b69c9ac..3e2c930 100644
--- a/node_modules/@cucumber/cucumber/lib/support_code_library_builder/build_helpers.js
+++ b/node_modules/@cucumber/cucumber/lib/support_code_library_builder/build_helpers.js
@@ -20,7 +20,7 @@ function getDefinitionLineAndUri(cwd) {
     if (value_checker_1.doesHaveValue(stackframe)) {
         line = stackframe.getLineNumber();
         uri = stackframe.getFileName();
-        if (value_checker_1.doesHaveValue(uri)) {
+        if (value_checker_1.doesHaveValue(uri) && value_checker_1.doesHaveValue(cwd)) {
             uri = path_1.default.relative(cwd, uri);
         }
     }
diff --git a/node_modules/@cucumber/cucumber/lib/support_code_library_builder/index.js b/node_modules/@cucumber/cucumber/lib/support_code_library_builder/index.js
index e92b2b2..8d84b0f 100644
--- a/node_modules/@cucumber/cucumber/lib/support_code_library_builder/index.js
+++ b/node_modules/@cucumber/cucumber/lib/support_code_library_builder/index.js
@@ -54,6 +54,9 @@ class SupportCodeLibraryBuilder {
             code = options;
             options = {};
         }
+        if (!this.stepDefinitionConfigs) {
+            this.stepDefinitionConfigs = [];
+        }
         const { line, uri } = build_helpers_1.getDefinitionLineAndUri(this.cwd);
         validate_arguments_1.default({
             args: { code, pattern, options },
